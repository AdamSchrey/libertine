description "Puritine Click chroot linking"

start on started unity8

script
PACKAGE_PATH=`click pkgdir com.ubuntu.puritine`
CONTAINER_NAME=puritine
CHROOT_PATH=$PACKAGE_PATH/libertine-data/libertine-container/$CONTAINER_NAME

if [ -x $CHROOT_PATH/rootfs ] ; then
	# Link the chroot
	if [ ! -L $HOME/.cache/libertine-container/$CONTAINER_NAME/rootfs ] ; then
		mkdir -p $HOME/.cache/libertine-container/$CONTAINER_NAME/
		ln -s $CHROOT_PATH/rootfs $HOME/.cache/libertine-container/$CONTAINER_NAME/rootfs
	fi

	# Link the container config
	if [ ! -L $HOME/.local/share/libertine/ContainersConfig.json ] ; then
		mkdir -p $HOME/.local/share/libertine/
		ln -s $PACKAGE_PATH/libertine-config/libertine/ContainersConfig.json $HOME/.local/share/libertine/ContainersConfig.json
	fi

	# Create the Compiz config directories
	if [ ! -d $HOME/.local/share/libertine-container/user-data/$CONTAINER_NAME/.config/compiz-1/compizconfig ] ; then
		mkdir -p $HOME/.local/share/libertine-container/user-data/$CONTAINER_NAME/.config/compiz-1/compizconfig/
	fi

	# Remove any previous Compiz config symbolic links
	if [ -L $HOME/.local/share/libertine-container/user-data/$CONTAINER_NAME/.config/compiz-1/compizconfig/Default.ini ] ; then
		rm $HOME/.local/share/libertine-container/user-data/$CONTAINER_NAME/.config/compiz-1/compizconfig/Default.ini
	fi

	if [ -L $HOME/.local/share/libertine-container/user-data/$CONTAINER_NAME/.config/compiz-1/compizconfig/Default.ini ] ; then
		rm $HOME/.local/share/libertine-container/user-data/$CONTAINER_NAME/.config/compiz-1/compizconfig/Default.ini
	fi

	# Copy the Compiz configs from the click package in case they have been updated
	cp $PACKAGE_PATH/libertine-config/libertine-container/user-data/$CONTAINER_NAME/.config/compiz-1/compizconfig/config $HOME/.local/share/libertine-container/user-data/$CONTAINER_NAME/.config/compiz-1/compizconfig/config
	cp $PACKAGE_PATH/libertine-config/libertine-container/user-data/$CONTAINER_NAME/.config/compiz-1/compizconfig/Default.ini $HOME/.local/share/libertine-container/user-data/$CONTAINER_NAME/.config/compiz-1/compizconfig/Default.ini
	fi
else
	rm -rf $HOME/.cache/libertine-container/$CONTAINER_NAME
	rm -rf $HOME/.local/share/libertine
	rm -rf $HOME/.local/share/libertine-container/user-data/$CONTAINER_NAME/.config/
fi
end script
